<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Data relations</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">The Research Cycle</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="01_intro.html">1: intro</a>
</li>
<li>
  <a href="02_tidy.html">2: tidy</a>
</li>
<li>
  <a href="03_ggplot.html">3: ggplot</a>
</li>
<li>
  <a href="04_dplyr.html">4: dplyr</a>
</li>
<li>
  <a href="05_joins.html">5: joins</a>
</li>
<li>
  <a href="06_functions.html">6: functions</a>
</li>
<li>
  <a href="07_simulation.html">7: simulation</a>
</li>
<li>
  <a href="08_glm.html">8: glm</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data relations</h1>

</div>


<div id="learning-objectives" class="section level2 tabset">
<h2>Learning Objectives</h2>
<div id="basic" class="section level3">
<h3>Basic</h3>
<ol style="list-style-type: decimal">
<li>Be able to use the 4 mutating join verbs:
<ul>
<li><code>left_join()</code></li>
<li><code>right_join()</code></li>
<li><code>inner_join()</code></li>
<li><code>outer_join()</code></li>
</ul></li>
<li>Be able to use the 2 binding join verb:
<ul>
<li><code>bind_rows()</code></li>
<li><code>bind_cols()</code></li>
</ul></li>
</ol>
</div>
<div id="intermediate" class="section level3">
<h3>Intermediate</h3>
<ol start="2" style="list-style-type: decimal">
<li>Be able to use the 2 filtering join verbs:
<ul>
<li><code>semi_join()</code></li>
<li><code>anti_join()</code></li>
</ul></li>
</ol>
</div>
<div id="advanced" class="section level3">
<h3>Advanced</h3>
<ol start="3" style="list-style-type: decimal">
<li>Be able to use the 3 set operations:
<ul>
<li><code>intersect()</code></li>
<li><code>union()</code></li>
<li><code>setdiff()</code></li>
</ul></li>
</ol>
</div>
</div>
<div id="prep" class="section level2">
<h2>Prep</h2>
<ul>
<li>Read <a href="http://r4ds.had.co.nz/relational-data.html">Chapter 13: Relational Data</a> in <em>R for Data Science</em></li>
</ul>
</div>
<div id="resources" class="section level2">
<h2>Resources</h2>
<ul>
<li><a href="http://stat545.com/bit001_dplyr-cheatsheet.html#full_joinsuperheroes-publishers">Cheatsheet for dplyr join functions</a></li>
</ul>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># libraries needed for these graphs</span>
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(readxl)</code></pre></div>
<div id="load-and-process-data" class="section level3">
<h3>Load and process data</h3>
<p>These data and cleaning code are from <a href="02_tidyr.html">Data cleaning</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load country data from a CSV file on the web</span>
ccodes &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv&quot;</span>)

infmort &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/infmort.csv&quot;</span>) %&gt;%<span class="st">  </span><span class="co"># load infant mortality data from a CSV file</span>
<span class="st">  </span><span class="kw">separate</span>(                                  <span class="co"># separate the stats column into its 3 parts</span>
    <span class="dv">3</span>, 
    <span class="kw">c</span>(<span class="st">&quot;rate&quot;</span>, <span class="st">&quot;ci_low&quot;</span>, <span class="st">&quot;ci_hi&quot;</span>), 
    <span class="dt">extra =</span> <span class="st">&quot;drop&quot;</span>, 
    <span class="dt">sep =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">[|-|])&quot;</span>, 
    <span class="dt">convert =</span> <span class="ot">TRUE</span>
  )

matmort &lt;-<span class="st"> </span><span class="kw">read_xls</span>(<span class="st">&quot;data/matmort.xls&quot;</span>) %&gt;%<span class="st">   </span><span class="co"># load maternal mortality data from an excel file</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;stats&quot;</span>, <span class="st">`</span><span class="dt">1990</span><span class="st">`</span>:<span class="st">`</span><span class="dt">2015</span><span class="st">`</span>) %&gt;%<span class="st">  </span><span class="co"># convert to long format</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">stats =</span> <span class="kw">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;&quot;</span>, stats)) %&gt;%<span class="st">    </span><span class="co"># get rid of spaces in stats column</span>
<span class="st">  </span><span class="kw">separate</span>(                                   <span class="co"># separate the stats column into its 3 parts</span>
    stats, 
    <span class="kw">c</span>(<span class="st">&quot;rate&quot;</span>, <span class="st">&quot;ci_low&quot;</span>, <span class="st">&quot;ci_hi&quot;</span>), 
    <span class="dt">extra =</span> <span class="st">&quot;drop&quot;</span>, 
    <span class="dt">convert =</span> <span class="ot">TRUE</span>
  )</code></pre></div>
</div>
<div id="inner_join" class="section level3">
<h3>inner_join()</h3>
<p><code>inner_join(x, y, by = NULL, suffix = c(&quot;.x&quot;, &quot;.y&quot;)</code></p>
<p>Use an <code>inner_join()</code> if you only want matching data between two tables and want to exclude any data from either table that doesn’t have a match in the other table.</p>
<ul>
<li>x = the first table (order doesn’t matter here)</li>
<li>y = the second table (order doesn’t matter here)</li>
<li>by = what columns to match on. If you leave this blank, it will match on any columns with the same names in the two tables.</li>
<li>suffix = if columns have the same name in the two tables, but you aren’t joining by them, they get a suffix to make them unambiguous. This defaults to “.x” and “.y”, but you can change it to something more meaningful.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#infmatmort &lt;- inner_join(matmort, infmort, by = c(&quot;Country&quot;, &quot;Year&quot;))</span></code></pre></div>
<pre><code>Error in inner_join_impl(x, y, by$x, by$y, suffix$x, suffix$y, check_na_matches(na_matches)) : 
  Can't join on 'Year' x 'Year' because of incompatible types (character / integer)</code></pre>
<div id="incompatible-tpyes" class="section level4">
<h4>Incompatible tpyes</h4>
<p>Oops. <code>Year</code> is an integer type in <code>nfmort</code> and a character type in <code>matmort</code>. We can fix that by adding <code>convert = TRUE</code> to the <code>gather</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">matmort &lt;-<span class="st"> </span><span class="kw">read_xls</span>(<span class="st">&quot;data/matmort.xls&quot;</span>) %&gt;%<span class="st">   </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;stats&quot;</span>, <span class="st">`</span><span class="dt">1990</span><span class="st">`</span>:<span class="st">`</span><span class="dt">2015</span><span class="st">`</span>, <span class="dt">convert =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">stats =</span> <span class="kw">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;&quot;</span>, stats)) %&gt;%
<span class="st">  </span><span class="kw">separate</span>(
    stats, 
    <span class="kw">c</span>(<span class="st">&quot;rate&quot;</span>, <span class="st">&quot;ci_low&quot;</span>, <span class="st">&quot;ci_hi&quot;</span>), 
    <span class="dt">extra =</span> <span class="st">&quot;drop&quot;</span>, 
    <span class="dt">convert =</span> <span class="ot">TRUE</span>
  )

infmatmort &lt;-<span class="st"> </span><span class="kw">inner_join</span>(matmort, infmort, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Country&quot;</span>, <span class="st">&quot;Year&quot;</span>))

<span class="kw">glimpse</span>(infmatmort)</code></pre></div>
<pre><code>## Observations: 543
## Variables: 8
## $ Country  &lt;chr&gt; &quot;Afghanistan&quot;, &quot;Albania&quot;, &quot;Algeria&quot;, &quot;Angola&quot;, &quot;Argen...
## $ Year     &lt;int&gt; 1990, 1990, 1990, 1990, 1990, 1990, 1990, 1990, 1990,...
## $ rate.x   &lt;int&gt; 1340, 71, 216, 1160, 72, 58, 8, 8, 64, 46, 26, 569, 5...
## $ ci_low.x &lt;int&gt; 878, 58, 141, 627, 64, 51, 7, 7, 56, 34, 20, 446, 47,...
## $ ci_hi.x  &lt;int&gt; 1950, 88, 327, 2020, 80, 65, 9, 10, 74, 61, 33, 715, ...
## $ rate.y   &lt;dbl&gt; 122.5, 35.1, 39.7, 133.5, 24.4, 42.5, 7.6, 8.0, 75.5,...
## $ ci_low.y &lt;dbl&gt; 111.6, 31.3, 37.1, 119.9, 24.0, 39.0, 7.4, 7.8, 69.0,...
## $ ci_hi.y  &lt;dbl&gt; 135.5, 39.2, 42.3, 151.0, 24.9, 46.4, 7.7, 8.2, 82.3,...</code></pre>
</div>
<div id="disambiguate-duplicate-column-names-with-suffix" class="section level4">
<h4>Disambiguate duplicate column names with <code>suffix</code></h4>
<p>Maybe we shouldn’t have given the rates and CIs the same names in the infant and maternal mortality tables if we were going to join them. We could fix that by changing the names in the <code>separate</code> functions to be unique. Here, we’ll add the suffixes “_mat&quot; and “_inf&quot; to distinguish them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infmatmort &lt;-<span class="st"> </span><span class="kw">inner_join</span>(
  matmort, 
  infmort, 
  <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Country&quot;</span>, <span class="st">&quot;Year&quot;</span>),
  <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;_mat&quot;</span>, <span class="st">&quot;_inf&quot;</span>)
)

<span class="kw">glimpse</span>(infmatmort)</code></pre></div>
<pre><code>## Observations: 543
## Variables: 8
## $ Country    &lt;chr&gt; &quot;Afghanistan&quot;, &quot;Albania&quot;, &quot;Algeria&quot;, &quot;Angola&quot;, &quot;Arg...
## $ Year       &lt;int&gt; 1990, 1990, 1990, 1990, 1990, 1990, 1990, 1990, 199...
## $ rate_mat   &lt;int&gt; 1340, 71, 216, 1160, 72, 58, 8, 8, 64, 46, 26, 569,...
## $ ci_low_mat &lt;int&gt; 878, 58, 141, 627, 64, 51, 7, 7, 56, 34, 20, 446, 4...
## $ ci_hi_mat  &lt;int&gt; 1950, 88, 327, 2020, 80, 65, 9, 10, 74, 61, 33, 715...
## $ rate_inf   &lt;dbl&gt; 122.5, 35.1, 39.7, 133.5, 24.4, 42.5, 7.6, 8.0, 75....
## $ ci_low_inf &lt;dbl&gt; 111.6, 31.3, 37.1, 119.9, 24.0, 39.0, 7.4, 7.8, 69....
## $ ci_hi_inf  &lt;dbl&gt; 135.5, 39.2, 42.3, 151.0, 24.9, 46.4, 7.7, 8.2, 82....</code></pre>
</div>
</div>
<div id="left_join" class="section level3">
<h3>left_join()</h3>
<p><code>left_join(x, y, by = NULL, suffix = c(&quot;.x&quot;, &quot;.y&quot;)</code></p>
<p>Use a <code>left_join()</code> if you want to keep all the data in the main (x, left) table and join data from another (y, right) table if it exists.</p>
<p class="fyi">
Notice by = c(“Country” = “name”)
</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infmatmort_region &lt;-<span class="st"> </span>infmatmort %&gt;%
<span class="st">  </span><span class="kw">left_join</span>(ccodes, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Country&quot;</span> =<span class="st"> &quot;name&quot;</span>))

<span class="kw">glimpse</span>(infmatmort_region)</code></pre></div>
<pre><code>## Observations: 543
## Variables: 16
## $ Country           &lt;chr&gt; &quot;Afghanistan&quot;, &quot;Albania&quot;, &quot;Algeria&quot;, &quot;Angola...
## $ Year              &lt;int&gt; 1990, 1990, 1990, 1990, 1990, 1990, 1990, 19...
## $ rate_mat          &lt;int&gt; 1340, 71, 216, 1160, 72, 58, 8, 8, 64, 46, 2...
## $ ci_low_mat        &lt;int&gt; 878, 58, 141, 627, 64, 51, 7, 7, 56, 34, 20,...
## $ ci_hi_mat         &lt;int&gt; 1950, 88, 327, 2020, 80, 65, 9, 10, 74, 61, ...
## $ rate_inf          &lt;dbl&gt; 122.5, 35.1, 39.7, 133.5, 24.4, 42.5, 7.6, 8...
## $ ci_low_inf        &lt;dbl&gt; 111.6, 31.3, 37.1, 119.9, 24.0, 39.0, 7.4, 7...
## $ ci_hi_inf         &lt;dbl&gt; 135.5, 39.2, 42.3, 151.0, 24.9, 46.4, 7.7, 8...
## $ `alpha-2`         &lt;chr&gt; &quot;AF&quot;, &quot;AL&quot;, &quot;DZ&quot;, &quot;AO&quot;, &quot;AR&quot;, &quot;AM&quot;, &quot;AU&quot;, &quot;A...
## $ `alpha-3`         &lt;chr&gt; &quot;AFG&quot;, &quot;ALB&quot;, &quot;DZA&quot;, &quot;AGO&quot;, &quot;ARG&quot;, &quot;ARM&quot;, &quot;A...
## $ `country-code`    &lt;chr&gt; &quot;004&quot;, &quot;008&quot;, &quot;012&quot;, &quot;024&quot;, &quot;032&quot;, &quot;051&quot;, &quot;0...
## $ `iso_3166-2`      &lt;chr&gt; &quot;ISO 3166-2:AF&quot;, &quot;ISO 3166-2:AL&quot;, &quot;ISO 3166-...
## $ region            &lt;chr&gt; &quot;Asia&quot;, &quot;Europe&quot;, &quot;Africa&quot;, &quot;Africa&quot;, &quot;Ameri...
## $ `sub-region`      &lt;chr&gt; &quot;Southern Asia&quot;, &quot;Southern Europe&quot;, &quot;Norther...
## $ `region-code`     &lt;chr&gt; &quot;142&quot;, &quot;150&quot;, &quot;002&quot;, &quot;002&quot;, &quot;019&quot;, &quot;142&quot;, &quot;0...
## $ `sub-region-code` &lt;chr&gt; &quot;034&quot;, &quot;039&quot;, &quot;015&quot;, &quot;017&quot;, &quot;005&quot;, &quot;145&quot;, &quot;0...</code></pre>
</div>
<div id="unwanted-columns" class="section level3">
<h3>Unwanted columns</h3>
<p><code>right_join(optional.data, main.data, by = c(&quot;opt.col&quot; = &quot;main.col&quot;)</code></p>
<p>We really just wanted the region, not all the extra data from the country codes. We can just select the columns we want when we load the country codes data. If we start with the <code>ccodes</code> table, we can <code>right_join()</code> the <code>infmatmort</code> table, which is just the opposite of a left join (keeps all the data from the “right” joined table and any data from the “left” table that matches). Remember to switch the order of the <code>by</code> columns if they have different names in the main and optional data tables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infmatmort_region &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(name, region) %&gt;%
<span class="st">  </span><span class="kw">right_join</span>(infmatmort, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;name&quot;</span> =<span class="st"> &quot;Country&quot;</span>))

infmatmort_region[<span class="dv">1</span>:<span class="dv">5</span>, ]</code></pre></div>
<pre><code>## # A tibble: 5 x 9
##          name   region  Year rate_mat ci_low_mat ci_hi_mat rate_inf
##         &lt;chr&gt;    &lt;chr&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;     &lt;int&gt;    &lt;dbl&gt;
## 1 Afghanistan     Asia  1990     1340        878      1950    122.5
## 2     Albania   Europe  1990       71         58        88     35.1
## 3     Algeria   Africa  1990      216        141       327     39.7
## 4      Angola   Africa  1990     1160        627      2020    133.5
## 5   Argentina Americas  1990       72         64        80     24.4
## # ... with 2 more variables: ci_low_inf &lt;dbl&gt;, ci_hi_inf &lt;dbl&gt;</code></pre>
</div>
<div id="plot-maternal-vs-infant-mortality-by-region" class="section level3">
<h3>Plot maternal vs infant mortality by region</h3>
<p>So let’s make a graph that we couldn’t have easily made with 3 separate data tables</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infmatmort_region %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(name, region) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">matmort =</span> <span class="kw">mean</span>(rate_mat),
    <span class="dt">infmort =</span> <span class="kw">mean</span>(rate_inf)
  ) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(infmort, matmort, <span class="dt">colour =</span> region)) +
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">facet_grid</span>(.~region)</code></pre></div>
<p><img src="images/05/unnamed-chunk-8-1.png" width="768" /></p>
</div>
</div>

<!--
<p class="footer">
  This course free to use in any way under the
  <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0 License</a>
</p>
-->


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
