<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Data relations</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">The Research Cycle</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="01_intro.html">1: intro</a>
</li>
<li>
  <a href="02_ggplot.html">2: ggplot</a>
</li>
<li>
  <a href="03_tidyr.html">3: tidyr</a>
</li>
<li>
  <a href="04_dplyr.html">4: dplyr</a>
</li>
<li>
  <a href="05_joins.html">5: joins</a>
</li>
<li>
  <a href="06_functions.html">6: functions</a>
</li>
<li>
  <a href="07_simulation.html">7: simulation</a>
</li>
<li>
  <a href="08_glm.html">8: glm</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data relations</h1>

</div>


<div id="learning-objectives" class="section level2 tabset">
<h2>Learning Objectives</h2>
<div id="basic" class="section level3">
<h3>Basic</h3>
<ol style="list-style-type: decimal">
<li>Be able to use the 4 mutating join verbs:
<ul>
<li><code>left_join()</code></li>
<li><code>right_join()</code></li>
<li><code>inner_join()</code></li>
<li><code>full_join()</code></li>
</ul></li>
<li>Be able to use the 2 binding join verb:
<ul>
<li><code>bind_rows()</code></li>
<li><code>bind_cols()</code></li>
</ul></li>
</ol>
</div>
<div id="intermediate" class="section level3">
<h3>Intermediate</h3>
<ol start="2" style="list-style-type: decimal">
<li>Be able to use the 2 filtering join verbs:
<ul>
<li><code>semi_join()</code></li>
<li><code>anti_join()</code></li>
</ul></li>
</ol>
</div>
<div id="advanced" class="section level3">
<h3>Advanced</h3>
<ol start="3" style="list-style-type: decimal">
<li>Be able to use the 3 set operations:
<ul>
<li><code>intersect()</code></li>
<li><code>union()</code></li>
<li><code>setdiff()</code></li>
</ul></li>
</ol>
</div>
</div>
<div id="prep" class="section level2">
<h2>Prep</h2>
<ul>
<li>Read <a href="http://r4ds.had.co.nz/relational-data.html">Chapter 13: Relational Data</a> in <em>R for Data Science</em></li>
</ul>
</div>
<div id="resources" class="section level2">
<h2>Resources</h2>
<ul>
<li><a href="http://stat545.com/bit001_dplyr-cheatsheet.html#full_joinsuperheroes-publishers">Cheatsheet for dplyr join functions</a></li>
</ul>
</div>
<div id="simple-example" class="section level2">
<h2>Simple Example</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># libraries needed for these examples</span>
<span class="kw">library</span>(tidyverse)</code></pre></div>
<p>All the joins have this basic syntax:</p>
<p><code>****_join(x, y, by = NULL, suffix = c(&quot;.x&quot;, &quot;.y&quot;)</code></p>
<ul>
<li><code>x</code> = the first (left) table</li>
<li><code>y</code> = the second (right) table</li>
<li><code>by</code> = what columns to match on. If you leave this blank, it will match on all columns with the same names in the two tables.</li>
<li><code>suffix</code> = if columns have the same name in the two tables, but you aren’t joining by them, they get a suffix to make them unambiguous. This defaults to “.x” and “.y”, but you can change it to something more meaningful.</li>
</ul>
<div id="data" class="section level3">
<h3>Data</h3>
<p>First, we’ll create two small data tables.</p>
<p><code>subject</code> has id, sex and age for subjects 1-5. Age and sex are missing for subject 3.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subject &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">id =</span> <span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">5</span>),
  <span class="dt">sex =</span> <span class="kw">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="ot">NA</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>),
  <span class="dt">age =</span> <span class="kw">c</span>(<span class="dv">19</span>, <span class="dv">22</span>, <span class="ot">NA</span>, <span class="dv">19</span>, <span class="dv">18</span>)
)

subject</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["sex"],"name":[2],"type":["chr"],"align":["left"]},{"label":["age"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"m","3":"19"},{"1":"2","2":"m","3":"22"},{"1":"3","2":"NA","3":"NA"},{"1":"4","2":"f","3":"19"},{"1":"5","2":"f","3":"18"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><code>exp</code> has subject id and the score from an experiment. Some subjects are missing, some completed twice, and some are not in the subject table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">id =</span> <span class="kw">c</span>(<span class="kw">seq</span>(<span class="dv">2</span>,<span class="dv">6</span>), <span class="kw">seq</span>(<span class="dv">4</span>,<span class="dv">7</span>)),
  <span class="dt">score =</span> <span class="kw">rnorm</span>(<span class="dv">9</span>)
)

exp</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["score"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"2","2":"1.0437068"},{"1":"3","2":"-1.4044567"},{"1":"4","2":"-1.2524376"},{"1":"5","2":"1.2598307"},{"1":"6","2":"1.4312638"},{"1":"4","2":"-0.6276617"},{"1":"5","2":"-1.0103657"},{"1":"6","2":"1.7361773"},{"1":"7","2":"1.3312410"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="left_join" class="section level3">
<h3>left_join()</h3>
<p>A <code>left_join</code> keeps all the data from the first (left) table and joins anything that matches from the second (right) table. If there is more than one match for a row in the right table, there will be more than one row in the joined table (see ids 4 and 5).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">left_join</span>(subject, exp, <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["sex"],"name":[2],"type":["chr"],"align":["left"]},{"label":["age"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["score"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"m","3":"19","4":"NA"},{"1":"2","2":"m","3":"22","4":"1.0437068"},{"1":"3","2":"NA","3":"NA","4":"-1.4044567"},{"1":"4","2":"f","3":"19","4":"-1.2524376"},{"1":"4","2":"f","3":"19","4":"-0.6276617"},{"1":"5","2":"f","3":"18","4":"1.2598307"},{"1":"5","2":"f","3":"18","4":"-1.0103657"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>You can leave out the <code>by</code> argument if you’re matching on all of the columns with the same name, but it’s good parctice to always specify it so your code is robust to changes in the loaded data.</p>
<p>The order of tables is swapped here, so the result is all rows from the <code>exp</code> table joined to any matching rows from the <code>subject</code> table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">left_join</span>(exp, subject)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["score"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sex"],"name":[3],"type":["chr"],"align":["left"]},{"label":["age"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"2","2":"1.0437068","3":"m","4":"22"},{"1":"3","2":"-1.4044567","3":"NA","4":"NA"},{"1":"4","2":"-1.2524376","3":"f","4":"19"},{"1":"5","2":"1.2598307","3":"f","4":"18"},{"1":"6","2":"1.4312638","3":"NA","4":"NA"},{"1":"4","2":"-0.6276617","3":"f","4":"19"},{"1":"5","2":"-1.0103657","3":"f","4":"18"},{"1":"6","2":"1.7361773","3":"NA","4":"NA"},{"1":"7","2":"1.3312410","3":"NA","4":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="inner_join" class="section level3">
<h3>inner_join()</h3>
<p>An <code>inner_join</code> returns all the rows that have a match in the other table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">inner_join</span>(subject, exp, <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["sex"],"name":[2],"type":["chr"],"align":["left"]},{"label":["age"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["score"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"2","2":"m","3":"22","4":"1.0437068"},{"1":"3","2":"NA","3":"NA","4":"-1.4044567"},{"1":"4","2":"f","3":"19","4":"-1.2524376"},{"1":"4","2":"f","3":"19","4":"-0.6276617"},{"1":"5","2":"f","3":"18","4":"1.2598307"},{"1":"5","2":"f","3":"18","4":"-1.0103657"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="full_join" class="section level3">
<h3>full_join()</h3>
<p>A <code>full_join</code> lets you join up rows in two tables while keeping all of the information from both tables. If a row doesn’t have a match in the other table, the other table’s column values are set to <code>NA</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">full_join</span>(subject, exp, <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["sex"],"name":[2],"type":["chr"],"align":["left"]},{"label":["age"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["score"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"m","3":"19","4":"NA"},{"1":"2","2":"m","3":"22","4":"1.0437068"},{"1":"3","2":"NA","3":"NA","4":"-1.4044567"},{"1":"4","2":"f","3":"19","4":"-1.2524376"},{"1":"4","2":"f","3":"19","4":"-0.6276617"},{"1":"5","2":"f","3":"18","4":"1.2598307"},{"1":"5","2":"f","3":"18","4":"-1.0103657"},{"1":"6","2":"NA","3":"NA","4":"1.4312638"},{"1":"6","2":"NA","3":"NA","4":"1.7361773"},{"1":"7","2":"NA","3":"NA","4":"1.3312410"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="semi_join" class="section level3">
<h3>semi_join()</h3>
<p>A <code>semi_join</code> returns all rows from the left table where there are matching values in the right table, keeping just columns from the left table.</p>
<p>Unlike an inner join, a semi join will never duplicate the rows in the left table if there is more than one maching row in the right table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">semi_join</span>(subject, exp, <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["sex"],"name":[2],"type":["chr"],"align":["left"]},{"label":["age"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"2","2":"m","3":"22"},{"1":"3","2":"NA","3":"NA"},{"1":"4","2":"f","3":"19"},{"1":"5","2":"f","3":"18"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Order matters in a semi join.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">semi_join</span>(exp, subject, <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["score"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"2","2":"1.0437068"},{"1":"3","2":"-1.4044567"},{"1":"4","2":"-1.2524376"},{"1":"4","2":"-0.6276617"},{"1":"5","2":"1.2598307"},{"1":"5","2":"-1.0103657"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="anti_join" class="section level3">
<h3>anti_join()</h3>
<p>A <code>anti_join</code> return all rows from the left table where there are <em>not</em> matching values in the right table, keeping just columns from the left table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anti_join</span>(subject, exp, <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["sex"],"name":[2],"type":["chr"],"align":["left"]},{"label":["age"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"m","3":"19"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Order matters in an anti join.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anti_join</span>(exp, subject, <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["score"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"7","2":"1.331241"},{"1":"6","2":"1.431264"},{"1":"6","2":"1.736177"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="bind_rows" class="section level3">
<h3>bind_rows()</h3>
<p>You can combine the rows of two tables with <code>bind_rows</code>.</p>
<p>Here we’ll add subject data for subjects 6-9 and bind that to the original subject table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_subjects &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">id =</span> <span class="kw">seq</span>(<span class="dv">6</span>, <span class="dv">9</span>),
  <span class="dt">sex =</span> <span class="kw">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>),
  <span class="dt">age =</span> <span class="kw">c</span>(<span class="dv">19</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">19</span>)
)

<span class="kw">bind_rows</span>(subject, new_subjects)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["sex"],"name":[2],"type":["chr"],"align":["left"]},{"label":["age"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"m","3":"19"},{"1":"2","2":"m","3":"22"},{"1":"3","2":"NA","3":"NA"},{"1":"4","2":"f","3":"19"},{"1":"5","2":"f","3":"18"},{"1":"6","2":"m","3":"19"},{"1":"7","2":"m","3":"16"},{"1":"8","2":"f","3":"20"},{"1":"9","2":"f","3":"19"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The columns just have to have the same names, they don’t have to be in the same order. Any columns that differ between the two tables will just have <code>NA</code> values for entries from the other table.</p>
<p>If a row is duplicated between the two tables (like id 5 below), the row will also be duplicatedin the resulting table. If your tables have the exact same columns, you can use <code>union()</code> (see below) to avoid duplicates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_subjects &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">id =</span> <span class="kw">seq</span>(<span class="dv">5</span>, <span class="dv">9</span>),
  <span class="dt">age =</span> <span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">19</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">19</span>),
  <span class="dt">sex =</span> <span class="kw">c</span>(<span class="st">&quot;f&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>),
  <span class="dt">new =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)
)

<span class="kw">bind_rows</span>(subject, new_subjects)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["sex"],"name":[2],"type":["chr"],"align":["left"]},{"label":["age"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["new"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"m","3":"19","4":"NA"},{"1":"2","2":"m","3":"22","4":"NA"},{"1":"3","2":"NA","3":"NA","4":"NA"},{"1":"4","2":"f","3":"19","4":"NA"},{"1":"5","2":"f","3":"18","4":"NA"},{"1":"5","2":"f","3":"18","4":"1"},{"1":"6","2":"m","3":"19","4":"2"},{"1":"7","2":"m","3":"16","4":"3"},{"1":"8","2":"f","3":"20","4":"4"},{"1":"9","2":"f","3":"19","4":"5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="bind_cols" class="section level3">
<h3>bind_cols()</h3>
<p>You can merge two tables with the same number of rows using <code>bind_cols</code>. This is only useful if the two tables have their rows in the exact same order. The only advantage over a left join is when the tables don’t have any IDs to join by and you have to rely solely on their order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_info &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">new =</span> <span class="kw">rnorm</span>(<span class="dv">5</span>)
)

<span class="kw">bind_cols</span>(subject, new_info)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["sex"],"name":[2],"type":["chr"],"align":["left"]},{"label":["age"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["new"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"m","3":"19","4":"0.55367445"},{"1":"2","2":"m","3":"22","4":"0.11446267"},{"1":"3","2":"NA","3":"NA","4":"-0.43234380"},{"1":"4","2":"f","3":"19","4":"-0.07123557"},{"1":"5","2":"f","3":"18","4":"-0.94063453"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="intersect" class="section level3">
<h3>intersect()</h3>
<p><code>intersect()</code> returns all rows in two tables that match exactly. The columns don’t have to be in the same order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_subjects &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">id =</span> <span class="kw">seq</span>(<span class="dv">4</span>, <span class="dv">9</span>),
  <span class="dt">age =</span> <span class="kw">c</span>(<span class="dv">19</span>, <span class="dv">18</span>, <span class="dv">19</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">19</span>),
  <span class="dt">sex =</span> <span class="kw">c</span>(<span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>)
)

<span class="kw">intersect</span>(subject, new_subjects)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["sex"],"name":[2],"type":["chr"],"align":["left"]},{"label":["age"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"4","2":"f","3":"19"},{"1":"5","2":"f","3":"18"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="union" class="section level3">
<h3>union()</h3>
<p><code>union()</code> returns all the rows from both tables, removing duplicate rows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">union</span>(subject, new_subjects)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["sex"],"name":[2],"type":["chr"],"align":["left"]},{"label":["age"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"9","2":"f","3":"19"},{"1":"8","2":"f","3":"20"},{"1":"7","2":"m","3":"16"},{"1":"6","2":"m","3":"19"},{"1":"5","2":"f","3":"18"},{"1":"4","2":"f","3":"19"},{"1":"3","2":"NA","3":"NA"},{"1":"2","2":"m","3":"22"},{"1":"1","2":"m","3":"19"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="setdiff" class="section level3">
<h3>setdiff()</h3>
<p><code>setdiff</code> returns rows that are in the first table, but not in the second table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setdiff</span>(subject, new_subjects)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["age"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sex"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"19","3":"m"},{"1":"2","2":"22","3":"m"},{"1":"3","2":"NA","3":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Order matters for <code>setdiff</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setdiff</span>(new_subjects, subject)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["sex"],"name":[2],"type":["chr"],"align":["left"]},{"label":["age"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"6","2":"m","3":"19"},{"1":"7","2":"m","3":"16"},{"1":"8","2":"f","3":"20"},{"1":"9","2":"f","3":"19"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="realistic-example" class="section level2">
<h2>Realistic Example</h2>
<div id="load-and-process-data" class="section level3">
<h3>Load and process data</h3>
<p>These data and cleaning code are from <a href="03_tidyr.html">Data cleaning</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load country data from a CSV file on the web</span>
<span class="kw">library</span>(readxl)
ccodes &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv&quot;</span>)

infmort &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/infmort.csv&quot;</span>) %&gt;%<span class="st">  </span><span class="co"># load infant mortality data from a CSV file</span>
<span class="st">  </span><span class="kw">separate</span>(                                  <span class="co"># separate the stats column into its 3 parts</span>
    <span class="dv">3</span>, 
    <span class="kw">c</span>(<span class="st">&quot;rate&quot;</span>, <span class="st">&quot;ci_low&quot;</span>, <span class="st">&quot;ci_hi&quot;</span>), 
    <span class="dt">extra =</span> <span class="st">&quot;drop&quot;</span>, 
    <span class="dt">sep =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">[|-|])&quot;</span>, 
    <span class="dt">convert =</span> <span class="ot">TRUE</span>
  )

matmort &lt;-<span class="st"> </span><span class="kw">read_xls</span>(<span class="st">&quot;data/matmort.xls&quot;</span>) %&gt;%<span class="st">   </span><span class="co"># load maternal mortality data from an excel file</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;stats&quot;</span>, <span class="st">`</span><span class="dt">1990</span><span class="st">`</span>:<span class="st">`</span><span class="dt">2015</span><span class="st">`</span>) %&gt;%<span class="st">  </span><span class="co"># convert to long format</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">stats =</span> <span class="kw">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;&quot;</span>, stats)) %&gt;%<span class="st">    </span><span class="co"># get rid of spaces in stats column</span>
<span class="st">  </span><span class="kw">separate</span>(                                   <span class="co"># separate the stats column into its 3 parts</span>
    stats, 
    <span class="kw">c</span>(<span class="st">&quot;rate&quot;</span>, <span class="st">&quot;ci_low&quot;</span>, <span class="st">&quot;ci_hi&quot;</span>), 
    <span class="dt">extra =</span> <span class="st">&quot;drop&quot;</span>, 
    <span class="dt">convert =</span> <span class="ot">TRUE</span>
  )</code></pre></div>
</div>
<div id="inner_join-1" class="section level3">
<h3>inner_join()</h3>
<p><code>inner_join(x, y, by = NULL, suffix = c(&quot;.x&quot;, &quot;.y&quot;)</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infmatmort &lt;-<span class="st"> </span><span class="kw">inner_join</span>(matmort, infmort, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Country&quot;</span>, <span class="st">&quot;Year&quot;</span>))</code></pre></div>
<pre><code>Error in inner_join_impl(x, y, by$x, by$y, suffix$x, suffix$y, check_na_matches(na_matches)) : 
  Can't join on 'Year' x 'Year' because of incompatible types (character / integer)</code></pre>
<div id="incompatible-tpyes" class="section level4">
<h4>Incompatible tpyes</h4>
<p>Oops. <code>Year</code> is an integer type in <code>infmort</code> and a character type in <code>matmort</code>. We can fix that by adding <code>convert = TRUE</code> to the <code>gather</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">matmort &lt;-<span class="st"> </span><span class="kw">read_xls</span>(<span class="st">&quot;data/matmort.xls&quot;</span>) %&gt;%<span class="st">   </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;stats&quot;</span>, <span class="st">`</span><span class="dt">1990</span><span class="st">`</span>:<span class="st">`</span><span class="dt">2015</span><span class="st">`</span>, <span class="dt">convert =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">stats =</span> <span class="kw">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;&quot;</span>, stats)) %&gt;%
<span class="st">  </span><span class="kw">separate</span>(
    stats, 
    <span class="kw">c</span>(<span class="st">&quot;rate&quot;</span>, <span class="st">&quot;ci_low&quot;</span>, <span class="st">&quot;ci_hi&quot;</span>), 
    <span class="dt">extra =</span> <span class="st">&quot;drop&quot;</span>, 
    <span class="dt">convert =</span> <span class="ot">TRUE</span>
  )

infmatmort &lt;-<span class="st"> </span><span class="kw">inner_join</span>(matmort, infmort, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Country&quot;</span>, <span class="st">&quot;Year&quot;</span>))

<span class="kw">glimpse</span>(infmatmort)</code></pre></div>
<pre><code>## Observations: 543
## Variables: 8
## $ Country  &lt;chr&gt; &quot;Afghanistan&quot;, &quot;Albania&quot;, &quot;Algeria&quot;, &quot;Angola&quot;, &quot;Argen...
## $ Year     &lt;int&gt; 1990, 1990, 1990, 1990, 1990, 1990, 1990, 1990, 1990,...
## $ rate.x   &lt;int&gt; 1340, 71, 216, 1160, 72, 58, 8, 8, 64, 46, 26, 569, 5...
## $ ci_low.x &lt;int&gt; 878, 58, 141, 627, 64, 51, 7, 7, 56, 34, 20, 446, 47,...
## $ ci_hi.x  &lt;int&gt; 1950, 88, 327, 2020, 80, 65, 9, 10, 74, 61, 33, 715, ...
## $ rate.y   &lt;dbl&gt; 122.5, 35.1, 39.7, 133.5, 24.4, 42.5, 7.6, 8.0, 75.5,...
## $ ci_low.y &lt;dbl&gt; 111.6, 31.3, 37.1, 119.9, 24.0, 39.0, 7.4, 7.8, 69.0,...
## $ ci_hi.y  &lt;dbl&gt; 135.5, 39.2, 42.3, 151.0, 24.9, 46.4, 7.7, 8.2, 82.3,...</code></pre>
</div>
<div id="disambiguate-duplicate-column-names-with-suffix" class="section level4">
<h4>Disambiguate duplicate column names with <code>suffix</code></h4>
<p>Maybe we shouldn’t have given the rates and CIs the same names in the infant and maternal mortality tables if we were going to join them. We could fix that by changing the names in the <code>separate</code> functions to be unique. Here, we’ll add the suffixes “_mat&quot; and “_inf&quot; to distinguish them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infmatmort &lt;-<span class="st"> </span><span class="kw">inner_join</span>(
  matmort, 
  infmort, 
  <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Country&quot;</span>, <span class="st">&quot;Year&quot;</span>),
  <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;_mat&quot;</span>, <span class="st">&quot;_inf&quot;</span>)
)

<span class="kw">glimpse</span>(infmatmort)</code></pre></div>
<pre><code>## Observations: 543
## Variables: 8
## $ Country    &lt;chr&gt; &quot;Afghanistan&quot;, &quot;Albania&quot;, &quot;Algeria&quot;, &quot;Angola&quot;, &quot;Arg...
## $ Year       &lt;int&gt; 1990, 1990, 1990, 1990, 1990, 1990, 1990, 1990, 199...
## $ rate_mat   &lt;int&gt; 1340, 71, 216, 1160, 72, 58, 8, 8, 64, 46, 26, 569,...
## $ ci_low_mat &lt;int&gt; 878, 58, 141, 627, 64, 51, 7, 7, 56, 34, 20, 446, 4...
## $ ci_hi_mat  &lt;int&gt; 1950, 88, 327, 2020, 80, 65, 9, 10, 74, 61, 33, 715...
## $ rate_inf   &lt;dbl&gt; 122.5, 35.1, 39.7, 133.5, 24.4, 42.5, 7.6, 8.0, 75....
## $ ci_low_inf &lt;dbl&gt; 111.6, 31.3, 37.1, 119.9, 24.0, 39.0, 7.4, 7.8, 69....
## $ ci_hi_inf  &lt;dbl&gt; 135.5, 39.2, 42.3, 151.0, 24.9, 46.4, 7.7, 8.2, 82....</code></pre>
</div>
</div>
<div id="full_join-1" class="section level3">
<h3>full_join()</h3>
<p><code>full_join(x, y, by = NULL, suffix = c(&quot;.x&quot;, &quot;.y&quot;)</code></p>
<p>A full join lets you join up rows in two tables while keeping all of the information from both tables. If a row doesn’t have a match in the other table, the other table’s column values are set to <code>NA</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infmatmort &lt;-<span class="st"> </span><span class="kw">full_join</span>(
  matmort, 
  infmort, 
  <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Country&quot;</span>, <span class="st">&quot;Year&quot;</span>),
  <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;_mat&quot;</span>, <span class="st">&quot;_inf&quot;</span>)
)

infmatmort %&gt;%<span class="st"> </span><span class="kw">filter</span>(Country ==<span class="st"> &quot;Djibouti&quot;</span>, Year &lt;<span class="st"> </span><span class="dv">1993</span>)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Year"],"name":[2],"type":["int"],"align":["right"]},{"label":["rate_mat"],"name":[3],"type":["int"],"align":["right"]},{"label":["ci_low_mat"],"name":[4],"type":["int"],"align":["right"]},{"label":["ci_hi_mat"],"name":[5],"type":["int"],"align":["right"]},{"label":["rate_inf"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["ci_low_inf"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["ci_hi_inf"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"Djibouti","2":"1990","3":"517","4":"291","5":"907","6":"92.7","7":"81.2","8":"105.5"},{"1":"Djibouti","2":"1992","3":"NA","4":"NA","5":"NA","6":"89.6","7":"79.0","8":"101.8"},{"1":"Djibouti","2":"1991","3":"NA","4":"NA","5":"NA","6":"91.0","7":"80.0","8":"103.6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="left_join-1" class="section level3">
<h3>left_join()</h3>
<p><code>left_join(x, y, by = NULL, suffix = c(&quot;.x&quot;, &quot;.y&quot;)</code></p>
<p>Use a <code>left_join()</code> if you want to keep all the data in the main (x, left) table and join data from another (y, right) table if it exists.</p>
<p class="alert alert-warning">
Notice that the <code>by</code> argument now needs to specify both the left and right tables’ columns (<code>by = c(&quot;Country&quot; = &quot;name&quot;)</code>) because we’re joining on columns that have different names.
</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infmatmort_region &lt;-<span class="st"> </span>infmatmort %&gt;%
<span class="st">  </span><span class="kw">left_join</span>(ccodes, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Country&quot;</span> =<span class="st"> &quot;name&quot;</span>))

<span class="kw">glimpse</span>(infmatmort_region)</code></pre></div>
<pre><code>## Observations: 5,044
## Variables: 16
## $ Country           &lt;chr&gt; &quot;Afghanistan&quot;, &quot;Albania&quot;, &quot;Algeria&quot;, &quot;Angola...
## $ Year              &lt;int&gt; 1990, 1990, 1990, 1990, 1990, 1990, 1990, 19...
## $ rate_mat          &lt;int&gt; 1340, 71, 216, 1160, 72, 58, 8, 8, 64, 46, 2...
## $ ci_low_mat        &lt;int&gt; 878, 58, 141, 627, 64, 51, 7, 7, 56, 34, 20,...
## $ ci_hi_mat         &lt;int&gt; 1950, 88, 327, 2020, 80, 65, 9, 10, 74, 61, ...
## $ rate_inf          &lt;dbl&gt; 122.5, 35.1, 39.7, 133.5, 24.4, 42.5, 7.6, 8...
## $ ci_low_inf        &lt;dbl&gt; 111.6, 31.3, 37.1, 119.9, 24.0, 39.0, 7.4, 7...
## $ ci_hi_inf         &lt;dbl&gt; 135.5, 39.2, 42.3, 151.0, 24.9, 46.4, 7.7, 8...
## $ `alpha-2`         &lt;chr&gt; &quot;AF&quot;, &quot;AL&quot;, &quot;DZ&quot;, &quot;AO&quot;, &quot;AR&quot;, &quot;AM&quot;, &quot;AU&quot;, &quot;A...
## $ `alpha-3`         &lt;chr&gt; &quot;AFG&quot;, &quot;ALB&quot;, &quot;DZA&quot;, &quot;AGO&quot;, &quot;ARG&quot;, &quot;ARM&quot;, &quot;A...
## $ `country-code`    &lt;chr&gt; &quot;004&quot;, &quot;008&quot;, &quot;012&quot;, &quot;024&quot;, &quot;032&quot;, &quot;051&quot;, &quot;0...
## $ `iso_3166-2`      &lt;chr&gt; &quot;ISO 3166-2:AF&quot;, &quot;ISO 3166-2:AL&quot;, &quot;ISO 3166-...
## $ region            &lt;chr&gt; &quot;Asia&quot;, &quot;Europe&quot;, &quot;Africa&quot;, &quot;Africa&quot;, &quot;Ameri...
## $ `sub-region`      &lt;chr&gt; &quot;Southern Asia&quot;, &quot;Southern Europe&quot;, &quot;Norther...
## $ `region-code`     &lt;chr&gt; &quot;142&quot;, &quot;150&quot;, &quot;002&quot;, &quot;002&quot;, &quot;019&quot;, &quot;142&quot;, &quot;0...
## $ `sub-region-code` &lt;chr&gt; &quot;034&quot;, &quot;039&quot;, &quot;015&quot;, &quot;017&quot;, &quot;005&quot;, &quot;145&quot;, &quot;0...</code></pre>
</div>
<div id="right_join" class="section level3">
<h3>right_join()</h3>
<p><code>right_join(x, y, by = NULL, suffix = c(&quot;.x&quot;, &quot;.y&quot;)</code></p>
<p>We really just wanted the region, not all the extra data from the country codes. We can just select the columns we want when we load the country codes data.</p>
<p>If we start with the <code>ccodes</code> table, we can <code>right_join()</code> the <code>infmatmort</code> table, which is just the opposite of a left join (keeps all the data from the “right” joined table and any data from the “left” table that matches).</p>
<p class="alert alert-warning">
Remember to switch the order of the <code>by</code> columns if they have different names in the main and optional data tables.
</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infmatmort_region &lt;-<span class="st"> </span>ccodes %&gt;%
<span class="st">  </span><span class="kw">select</span>(name, region) %&gt;%
<span class="st">  </span><span class="kw">right_join</span>(infmatmort, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;name&quot;</span> =<span class="st"> &quot;Country&quot;</span>))

<span class="kw">glimpse</span>(infmatmort_region)</code></pre></div>
<pre><code>## Observations: 5,044
## Variables: 9
## $ name       &lt;chr&gt; &quot;Afghanistan&quot;, &quot;Albania&quot;, &quot;Algeria&quot;, &quot;Angola&quot;, &quot;Arg...
## $ region     &lt;chr&gt; &quot;Asia&quot;, &quot;Europe&quot;, &quot;Africa&quot;, &quot;Africa&quot;, &quot;Americas&quot;, &quot;...
## $ Year       &lt;int&gt; 1990, 1990, 1990, 1990, 1990, 1990, 1990, 1990, 199...
## $ rate_mat   &lt;int&gt; 1340, 71, 216, 1160, 72, 58, 8, 8, 64, 46, 26, 569,...
## $ ci_low_mat &lt;int&gt; 878, 58, 141, 627, 64, 51, 7, 7, 56, 34, 20, 446, 4...
## $ ci_hi_mat  &lt;int&gt; 1950, 88, 327, 2020, 80, 65, 9, 10, 74, 61, 33, 715...
## $ rate_inf   &lt;dbl&gt; 122.5, 35.1, 39.7, 133.5, 24.4, 42.5, 7.6, 8.0, 75....
## $ ci_low_inf &lt;dbl&gt; 111.6, 31.3, 37.1, 119.9, 24.0, 39.0, 7.4, 7.8, 69....
## $ ci_hi_inf  &lt;dbl&gt; 135.5, 39.2, 42.3, 151.0, 24.9, 46.4, 7.7, 8.2, 82....</code></pre>
</div>
<div id="plot-maternal-vs-infant-mortality-by-region" class="section level3">
<h3>Plot maternal vs infant mortality by region</h3>
<p>So let’s make a graph that we couldn’t have easily made with 3 separate data tables</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infmatmort_region %&gt;%
<span class="st">  </span><span class="kw">filter</span>(Year ==<span class="st"> </span><span class="dv">1990</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(name, region) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">matmort =</span> <span class="kw">mean</span>(rate_mat),
    <span class="dt">infmort =</span> <span class="kw">mean</span>(rate_inf)
  ) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(infmort, matmort, <span class="dt">colour =</span> region)) +
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">facet_grid</span>(.~region)</code></pre></div>
<p><img src="images/05/unnamed-chunk-42-1.png" width="768" /></p>
</div>
</div>
<div id="exercises" class="section level2">
<h2>Exercises</h2>
<div id="mutating-joins" class="section level3">
<h3>Mutating joins</h3>
<p>Load data from <a href="data/disgust.csv">disgust.csv</a>, <a href="data/personality.csv">personality.csv</a> and <a href="data/users.csv">users.csv</a>. Each participant is identified by a unique <code>user_id</code>.</p>
<p class="alert alert-warning">
Remember to check the <code>col_types</code> if you get warnings when loading datasets.
</p>
<ol style="list-style-type: decimal">
<li><p>Add participant data to the disgust table.</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">disgust &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/disgust.csv&quot;</span>)
ocean &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/personality.csv&quot;</span>)
user &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/users.csv&quot;</span>,
                 <span class="dt">col_types =</span> <span class="kw">list</span>(
                   <span class="kw">col_integer</span>(), 
                   <span class="kw">col_character</span>(),
                   <span class="kw">col_character</span>()
                  )
                 )

study &lt;-<span class="st"> </span><span class="kw">left_join</span>(disgust, user, <span class="dt">by =</span> <span class="st">&quot;user_id&quot;</span>)</code></pre></div>
</div></li>
<li><p>Add the participant data to the disgust data, but have the columns from the participant table first.</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study &lt;-<span class="st"> </span><span class="kw">right_join</span>(user, disgust, <span class="dt">by =</span> <span class="st">&quot;user_id&quot;</span>)</code></pre></div>
</div></li>
<li><p>Create a table with only disgust and personality data from the same <code>user_id</code> collected on the same <code>date</code>.</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study &lt;-<span class="st"> </span><span class="kw">inner_join</span>(disgust, ocean, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;user_id&quot;</span>, <span class="st">&quot;date&quot;</span>))</code></pre></div>
</div></li>
<li><p>Create a table of the disgust and personality data with each <code>user_id:date</code> on a single row, containing <em>all</em> of the data from both tables.</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study &lt;-<span class="st"> </span><span class="kw">full_join</span>(disgust, ocean, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;user_id&quot;</span>, <span class="st">&quot;date&quot;</span>))</code></pre></div>
</div></li>
</ol>
</div>
<div id="filtering-joins" class="section level3">
<h3>Filtering joins</h3>
<ol start="5" style="list-style-type: decimal">
<li><p>Create a table of just the data from the disgust table for users who completed the personality questionnaire that same day.</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study &lt;-<span class="st"> </span><span class="kw">semi_join</span>(disgust, ocean, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;user_id&quot;</span>, <span class="st">&quot;date&quot;</span>))</code></pre></div>
</div></li>
<li><p>Create a table of data from users who did not complete either the personality questionnaire or the disgust questionnaire. (<em>Hint: this will require two steps; use pipes.</em>)</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study &lt;-<span class="st"> </span>user %&gt;%
<span class="st">  </span><span class="kw">anti_join</span>(ocean, <span class="dt">by =</span> <span class="st">&quot;user_id&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">anti_join</span>(disgust, <span class="dt">by =</span> <span class="st">&quot;user_id&quot;</span>)</code></pre></div>
</div></li>
</ol>
</div>
<div id="binding-and-sets" class="section level3">
<h3>Binding and sets</h3>
<ol start="7" style="list-style-type: decimal">
<li><p>Load new user data from <a href="data/users2.csv">users2.csv</a>. Bind them into a single table.</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">user2 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/users2.csv&quot;</span>,
                 <span class="dt">col_types =</span> <span class="kw">list</span>(
                   <span class="kw">col_integer</span>(), 
                   <span class="kw">col_character</span>(),
                   <span class="kw">col_character</span>()
                  )
                 )
users_all &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(user, user2)</code></pre></div>
</div></li>
<li><p>How many users are in both the first and second user table?</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">intersect</span>(user, user2) %&gt;%<span class="st"> </span><span class="kw">nrow</span>()</code></pre></div>
<pre><code>## [1] 11602</code></pre>
</div></li>
<li><p>How many unique users are there in total across the first and second user tables?</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">union</span>(user, user2) %&gt;%<span class="st"> </span><span class="kw">nrow</span>()</code></pre></div>
<pre><code>## [1] 100441</code></pre>
</div></li>
<li><p>How many users are in the first, but not the second, user table?</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setdiff</span>(user, user2) %&gt;%<span class="st"> </span><span class="kw">nrow</span>()</code></pre></div>
<pre><code>## [1] 40441</code></pre>
</div></li>
<li><p>How many users are in the second, but not the first, user table?</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setdiff</span>(user2, user) %&gt;%<span class="st"> </span><span class="kw">nrow</span>()</code></pre></div>
<pre><code>## [1] 48398</code></pre>
</div></li>
</ol>
</div>
</div>

<!--
<p class="footer">
  This course free to use in any way under the
  <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0 License</a>
</p>
-->

<script>
  $(".solution").click(function() {
    $(this).toggleClass("open");
  });
</script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
