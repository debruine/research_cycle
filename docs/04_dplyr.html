<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Data manipulation</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">The Research Cycle</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="01_intro.html">1: intro</a>
</li>
<li>
  <a href="02_ggplot.html">2: ggplot</a>
</li>
<li>
  <a href="03_tidyr.html">3: tidyr</a>
</li>
<li>
  <a href="04_dplyr.html">4: dplyr</a>
</li>
<li>
  <a href="05_joins.html">5: joins</a>
</li>
<li>
  <a href="06_functions.html">6: functions</a>
</li>
<li>
  <a href="07_simulation.html">7: simulation</a>
</li>
<li>
  <a href="08_glm.html">8: glm</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data manipulation</h1>

</div>


<div id="learning-objectives" class="section level2 tabset">
<h2>Learning Objectives</h2>
<div id="basic" class="section level3">
<h3>Basic</h3>
<ol style="list-style-type: decimal">
<li>Be able to use the 6 main dplyr verbs:
<ul>
<li><a href="#select"><code>select()</code></a></li>
<li><a href="#filter"><code>filter()</code></a></li>
<li><a href="#arrange"><code>arrange()</code></a></li>
<li><a href="#mutate"><code>mutate()</code></a></li>
<li><a href="#summarise"><code>summarise()</code></a></li>
<li><a href="#group_by"><code>group_by()</code></a></li>
</ul></li>
</ol>
</div>
<div id="intermediate" class="section level3">
<h3>Intermediate</h3>
<ol start="2" style="list-style-type: decimal">
<li>Be able to use <code>lubridate</code> for simple <a href="#dates">date calculations</a></li>
<li>Be able to use the <code>select()</code> helpers
<ul>
<li><a href="#starts_with"><code>starts_with()</code></a></li>
<li><a href="#ends_with"><code>ends_with()</code></a></li>
<li><a href="#contains"><code>contains()</code></a></li>
<li><a href="#num_range"><code>num_range()</code></a></li>
</ul></li>
</ol>
</div>
<div id="advanced" class="section level3">
<h3>Advanced</h3>
<ol start="4" style="list-style-type: decimal">
<li>Master the <code>lubridate</code> package (and then teach Lisa)</li>
</ol>
</div>
</div>
<div id="prep" class="section level2">
<h2>Prep</h2>
<ul>
<li>Read <a href="http://r4ds.had.co.nz/transform.html">Chapter 5: Data Transformation</a> in <em>R for Data Science</em></li>
</ul>
</div>
<div id="resources" class="section level2">
<h2>Resources</h2>
<ul>
<li><a href="http://r4ds.had.co.nz/dates-and-times.html">Chapter 16: Date and times</a> in <em>R for Data Science</em></li>
<li><a href="https://github.com/rstudio/cheatsheets/raw/master/source/pdfs/data-transformation-cheatsheet.pdf">Data transformation cheat sheet</a></li>
</ul>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># libraries needed for these examples</span>
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(lubridate)</code></pre></div>
<p>These examples will use data from <a href="data/disgust.csv">disgust.csv</a>, which contains data from the <a href="http://digitalrepository.unm.edu/cgi/viewcontent.cgi?article=1139&amp;context=psy_etds">Three Domain Disgust Scale</a>. Each participant is identified by a unique <code>user_id</code> and each questionnaire completion has a unique <code>id</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">disgust &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/disgust.csv&quot;</span>)</code></pre></div>
<p><em>Questionnaire Instructions</em>: The following items describe a variety of concepts. Please rate how disgusting you find the concepts described in the items, where 0 means that you do not find the concept disgusting at all, and 6 means that you find the concept extremely disgusting.</p>
<table>
<colgroup>
<col width="12%" />
<col width="87%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">colname</th>
<th align="left">question</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">moral1</td>
<td align="left">Shoplifting a candy bar from a convenience store</td>
</tr>
<tr class="even">
<td align="right">moral2</td>
<td align="left">Stealing from a neighbor</td>
</tr>
<tr class="odd">
<td align="right">moral3</td>
<td align="left">A student cheating to get good grades</td>
</tr>
<tr class="even">
<td align="right">moral4</td>
<td align="left">Deceiving a friend</td>
</tr>
<tr class="odd">
<td align="right">moral5</td>
<td align="left">Forging someone’s signature on a legal document</td>
</tr>
<tr class="even">
<td align="right">moral6</td>
<td align="left">Cutting to the front of a line to purchase the last few tickets to a show</td>
</tr>
<tr class="odd">
<td align="right">moral7</td>
<td align="left">Intentionally lying during a business transaction</td>
</tr>
<tr class="even">
<td align="right">sexual1</td>
<td align="left">Hearing two strangers having sex</td>
</tr>
<tr class="odd">
<td align="right">sexual2</td>
<td align="left">Performing oral sex</td>
</tr>
<tr class="even">
<td align="right">sexual3</td>
<td align="left">Watching a pornographic video</td>
</tr>
<tr class="odd">
<td align="right">sexual4</td>
<td align="left">Finding out that someone you don’t like has sexual fantasies about you</td>
</tr>
<tr class="even">
<td align="right">sexual5</td>
<td align="left">Bringing someone you just met back to your room to have sex</td>
</tr>
<tr class="odd">
<td align="right">sexual6</td>
<td align="left">A stranger of the opposite sex intentionally rubbing your thigh in an elevator</td>
</tr>
<tr class="even">
<td align="right">sexual7</td>
<td align="left">Having anal sex with someone of the opposite sex</td>
</tr>
<tr class="odd">
<td align="right">pathogen1</td>
<td align="left">Stepping on dog poop</td>
</tr>
<tr class="even">
<td align="right">pathogen2</td>
<td align="left">Sitting next to someone who has red sores on their arm</td>
</tr>
<tr class="odd">
<td align="right">pathogen3</td>
<td align="left">Shaking hands with a stranger who has sweaty palms</td>
</tr>
<tr class="even">
<td align="right">pathogen4</td>
<td align="left">Seeing some mold on old leftovers in your refrigerator</td>
</tr>
<tr class="odd">
<td align="right">pathogen5</td>
<td align="left">Standing close to a person who has body odor</td>
</tr>
<tr class="even">
<td align="right">pathogen6</td>
<td align="left">Seeing a cockroach run across the floor</td>
</tr>
<tr class="odd">
<td align="right">pathogen7</td>
<td align="left">Accidentally touching a person’s bloody cut</td>
</tr>
</tbody>
</table>
<div id="select" class="section level3">
<h3>select()</h3>
<p><a name="#select"></a> Select columns by name or number.</p>
<p>You can select each column individually, separated by commas (e.g., <code>col1, col2</code>). You can also select all columns between two columns by separating them with a colon (e.g., <code>start_col:end_col</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">moral &lt;-<span class="st"> </span>disgust %&gt;%<span class="st"> </span><span class="kw">select</span>(user_id, moral1:moral7)
<span class="kw">glimpse</span>(moral)</code></pre></div>
<pre><code>## Observations: 20,000
## Variables: 8
## $ user_id &lt;int&gt; 0, 1, 2, 2118, 2311, 3630, 4458, 4651, 4976, 5469, 606...
## $ moral1  &lt;int&gt; 5, 2, 1, 0, 4, 1, 3, 2, 6, 0, 4, 1, 1, 4, 2, 1, NA, 3,...
## $ moral2  &lt;int&gt; 6, 2, 1, 1, 4, 5, 4, 4, 6, 1, 5, 2, 4, 4, 5, 3, NA, 5,...
## $ moral3  &lt;int&gt; 4, 1, 1, 1, 4, NA, 3, 3, 6, 3, 6, 2, 3, 4, 4, 2, NA, 4...
## $ moral4  &lt;int&gt; 6, 2, 1, 1, 4, 5, 4, 5, 0, 4, 5, 2, 4, 4, 6, 4, NA, 5,...
## $ moral5  &lt;int&gt; 5, 1, NA, 1, 4, 5, 4, 5, 6, 1, 5, 1, 3, 3, 5, 5, NA, 3...
## $ moral6  &lt;int&gt; 5, 1, NA, 2, 4, 5, 3, 5, 0, 0, 4, 2, 4, 3, 4, 4, NA, 4...
## $ moral7  &lt;int&gt; 6, 1, 1, 1, 4, 1, 3, 3, 0, 1, 4, 1, 3, 2, 5, 4, NA, 3,...</code></pre>
<p>You can select colmns by number, which is useful when the column names are long or complicated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sexual &lt;-<span class="st"> </span>disgust %&gt;%<span class="st"> </span><span class="kw">select</span>(<span class="dv">2</span>, <span class="dv">11</span>:<span class="dv">17</span>)
<span class="kw">glimpse</span>(sexual)</code></pre></div>
<pre><code>## Observations: 20,000
## Variables: 8
## $ user_id &lt;int&gt; 0, 1, 2, 2118, 2311, 3630, 4458, 4651, 4976, 5469, 606...
## $ sexual1 &lt;int&gt; 4, 3, 1, 4, 2, 0, 2, 4, 0, 3, 3, 1, 1, 4, 2, 0, NA, 1,...
## $ sexual2 &lt;int&gt; 0, 1, NA, 3, 1, 5, 4, 2, 0, 5, 0, 0, 0, 2, 1, 0, NA, 3...
## $ sexual3 &lt;int&gt; 1, 1, 1, 0, 2, 0, 3, 4, 0, 2, 1, 0, 0, 1, 0, 0, NA, 3,...
## $ sexual4 &lt;int&gt; 0, 2, NA, 6, 1, 2, 2, 6, 0, 4, 6, 3, 1, 3, 2, 0, NA, 5...
## $ sexual5 &lt;int&gt; 1, 1, 1, 0, 1, 0, 1, 6, 0, 6, 3, 0, 0, 2, 1, 0, NA, 5,...
## $ sexual6 &lt;int&gt; 4, 2, NA, 3, 1, 1, 5, 6, 0, 6, 5, 4, 2, 3, 4, 0, NA, 3...
## $ sexual7 &lt;int&gt; 5, 2, NA, 5, 5, 0, 4, 2, 0, 5, 3, 4, 1, 6, 3, 0, NA, 3...</code></pre>
<p>You can use a minus symbol to unselect columns, leaving all of the other columns. If you want to exclude a span of columns, put parentheses around the span first (e.g., <code>-(moral1:moral7)</code>, not <code>-moral1:moral7</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pathogen &lt;-<span class="st"> </span>disgust %&gt;%<span class="st"> </span><span class="kw">select</span>(-id, -date, -(moral1:sexual7))
<span class="kw">glimpse</span>(pathogen)</code></pre></div>
<pre><code>## Observations: 20,000
## Variables: 8
## $ user_id   &lt;int&gt; 0, 1, 2, 2118, 2311, 3630, 4458, 4651, 4976, 5469, 6...
## $ pathogen1 &lt;int&gt; 6, 3, NA, 5, 5, 6, 6, 5, 6, 5, 6, 4, 4, 5, 3, 5, NA,...
## $ pathogen2 &lt;int&gt; 1, 2, NA, 6, 5, 3, 4, 6, 6, 2, 5, 3, 4, 2, 3, 4, NA,...
## $ pathogen3 &lt;int&gt; 6, 3, 1, 4, 4, 1, 4, 6, 6, 4, 5, 1, 3, 0, 2, 3, NA, ...
## $ pathogen4 &lt;int&gt; 5, 3, NA, 6, 4, 1, 3, 4, 6, 4, 5, 1, 4, 4, 4, 1, NA,...
## $ pathogen5 &lt;int&gt; 4, 2, NA, 5, 5, 3, 3, 6, 0, 2, 5, 4, 5, 5, 5, 4, NA,...
## $ pathogen6 &lt;int&gt; 5, 3, NA, 5, 4, 1, 2, 1, 0, 2, 5, 1, 4, 5, 1, 2, NA,...
## $ pathogen7 &lt;int&gt; 6, 3, NA, 4, 3, 0, 3, 6, 6, 6, 5, 3, 5, 4, 5, 3, NA,...</code></pre>
</div>
<div id="select-helpers" class="section level3">
<h3>select() helpers</h3>
<p><a name="#select_helpers"></a> You can select columns based on criteria about the column names.</p>
<div id="starts_with" class="section level4">
<h4><code>starts_with()</code></h4>
<p><a name="#starts_with"></a> Select columns that start with a character string.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">u &lt;-<span class="st"> </span>disgust %&gt;%<span class="st"> </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;u&quot;</span>))
<span class="kw">glimpse</span>(u)</code></pre></div>
<pre><code>## Observations: 20,000
## Variables: 1
## $ user_id &lt;int&gt; 0, 1, 2, 2118, 2311, 3630, 4458, 4651, 4976, 5469, 606...</code></pre>
</div>
<div id="ends_with" class="section level4">
<h4><code>ends_with()</code></h4>
<p><a name="#ends_with"></a> Select columns that end with a character string.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">firstq &lt;-<span class="st"> </span>disgust %&gt;%<span class="st"> </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;1&quot;</span>))
<span class="kw">glimpse</span>(firstq)</code></pre></div>
<pre><code>## Observations: 20,000
## Variables: 3
## $ moral1    &lt;int&gt; 5, 2, 1, 0, 4, 1, 3, 2, 6, 0, 4, 1, 1, 4, 2, 1, NA, ...
## $ sexual1   &lt;int&gt; 4, 3, 1, 4, 2, 0, 2, 4, 0, 3, 3, 1, 1, 4, 2, 0, NA, ...
## $ pathogen1 &lt;int&gt; 6, 3, NA, 5, 5, 6, 6, 5, 6, 5, 6, 4, 4, 5, 3, 5, NA,...</code></pre>
</div>
<div id="contains" class="section level4">
<h4><code>contains()</code></h4>
<p><a name="#contains"></a> Select columns that contain a character string.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pathogen &lt;-<span class="st"> </span>disgust %&gt;%<span class="st"> </span><span class="kw">select</span>(<span class="kw">contains</span>(<span class="st">&quot;pathogen&quot;</span>))
<span class="kw">glimpse</span>(pathogen)</code></pre></div>
<pre><code>## Observations: 20,000
## Variables: 7
## $ pathogen1 &lt;int&gt; 6, 3, NA, 5, 5, 6, 6, 5, 6, 5, 6, 4, 4, 5, 3, 5, NA,...
## $ pathogen2 &lt;int&gt; 1, 2, NA, 6, 5, 3, 4, 6, 6, 2, 5, 3, 4, 2, 3, 4, NA,...
## $ pathogen3 &lt;int&gt; 6, 3, 1, 4, 4, 1, 4, 6, 6, 4, 5, 1, 3, 0, 2, 3, NA, ...
## $ pathogen4 &lt;int&gt; 5, 3, NA, 6, 4, 1, 3, 4, 6, 4, 5, 1, 4, 4, 4, 1, NA,...
## $ pathogen5 &lt;int&gt; 4, 2, NA, 5, 5, 3, 3, 6, 0, 2, 5, 4, 5, 5, 5, 4, NA,...
## $ pathogen6 &lt;int&gt; 5, 3, NA, 5, 4, 1, 2, 1, 0, 2, 5, 1, 4, 5, 1, 2, NA,...
## $ pathogen7 &lt;int&gt; 6, 3, NA, 4, 3, 0, 3, 6, 6, 6, 5, 3, 5, 4, 5, 3, NA,...</code></pre>
</div>
<div id="num_rangeprefix-range-width-null" class="section level4">
<h4><code>num_range(prefix, range, width = NULL)</code></h4>
<p><a name="#num_range"></a> Select columns with a name that matches the pattern <code>prefix#</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">moral2_4 &lt;-<span class="st"> </span>disgust %&gt;%<span class="st"> </span><span class="kw">select</span>(<span class="kw">num_range</span>(<span class="st">&quot;moral&quot;</span>, <span class="dv">2</span>:<span class="dv">4</span>))
<span class="kw">glimpse</span>(moral2_4)</code></pre></div>
<pre><code>## Observations: 20,000
## Variables: 3
## $ moral2 &lt;int&gt; 6, 2, 1, 1, 4, 5, 4, 4, 6, 1, 5, 2, 4, 4, 5, 3, NA, 5, ...
## $ moral3 &lt;int&gt; 4, 1, 1, 1, 4, NA, 3, 3, 6, 3, 6, 2, 3, 4, 4, 2, NA, 4,...
## $ moral4 &lt;int&gt; 6, 2, 1, 1, 4, 5, 4, 5, 0, 4, 5, 2, 4, 4, 6, 4, NA, 5, ...</code></pre>
<p class="alert alert-info">
Use <code>width</code> to set the number of digits with leading zeros. For example, <code>num_range(&quot;var_&quot;, 8:10, width=2)</code> selects columns <code>var_08</code>, <code>var_09</code>, and <code>var_10</code>.
</p>
</div>
</div>
<div id="filter" class="section level3">
<h3>filter()</h3>
<p><a name="#filter"></a> Select rows by matching column criteria.</p>
<p>Select all rows where the user_id is 1 (that’s Lisa).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">disgust %&gt;%<span class="st"> </span><span class="kw">filter</span>(user_id ==<span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["user_id"],"name":[2],"type":["int"],"align":["right"]},{"label":["date"],"name":[3],"type":["date"],"align":["right"]},{"label":["moral1"],"name":[4],"type":["int"],"align":["right"]},{"label":["moral2"],"name":[5],"type":["int"],"align":["right"]},{"label":["moral3"],"name":[6],"type":["int"],"align":["right"]},{"label":["moral4"],"name":[7],"type":["int"],"align":["right"]},{"label":["moral5"],"name":[8],"type":["int"],"align":["right"]},{"label":["moral6"],"name":[9],"type":["int"],"align":["right"]},{"label":["moral7"],"name":[10],"type":["int"],"align":["right"]},{"label":["sexual1"],"name":[11],"type":["int"],"align":["right"]},{"label":["sexual2"],"name":[12],"type":["int"],"align":["right"]},{"label":["sexual3"],"name":[13],"type":["int"],"align":["right"]},{"label":["sexual4"],"name":[14],"type":["int"],"align":["right"]},{"label":["sexual5"],"name":[15],"type":["int"],"align":["right"]},{"label":["sexual6"],"name":[16],"type":["int"],"align":["right"]},{"label":["sexual7"],"name":[17],"type":["int"],"align":["right"]},{"label":["pathogen1"],"name":[18],"type":["int"],"align":["right"]},{"label":["pathogen2"],"name":[19],"type":["int"],"align":["right"]},{"label":["pathogen3"],"name":[20],"type":["int"],"align":["right"]},{"label":["pathogen4"],"name":[21],"type":["int"],"align":["right"]},{"label":["pathogen5"],"name":[22],"type":["int"],"align":["right"]},{"label":["pathogen6"],"name":[23],"type":["int"],"align":["right"]},{"label":["pathogen7"],"name":[24],"type":["int"],"align":["right"]}],"data":[{"1":"1","2":"1","3":"2008-07-10","4":"2","5":"2","6":"1","7":"2","8":"1","9":"1","10":"1","11":"3","12":"1","13":"1","14":"2","15":"1","16":"2","17":"2","18":"3","19":"2","20":"3","21":"3","22":"2","23":"3","24":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p class="alert alert-warning">
Remember to use <code>==</code> and not <code>=</code> to check if two things are equivalent. A single <code>=</code> assigns the righthand value to the lefthand variable and (usually) evaluates to <code>TRUE</code>.
</p>
<p>You can select on multiple criteria by separating them with commas.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">amoral &lt;-<span class="st"> </span>disgust %&gt;%<span class="st"> </span><span class="kw">filter</span>(
  moral1 ==<span class="st"> </span><span class="dv">0</span>, 
  moral2 ==<span class="st"> </span><span class="dv">0</span>,
  moral3 ==<span class="st"> </span><span class="dv">0</span>, 
  moral4 ==<span class="st"> </span><span class="dv">0</span>,
  moral5 ==<span class="st"> </span><span class="dv">0</span>,
  moral6 ==<span class="st"> </span><span class="dv">0</span>,
  moral7 ==<span class="st"> </span><span class="dv">0</span>
)</code></pre></div>
<p>You can use the symbols <code>&amp;</code>, <code>|</code>, and <code>!</code> to mean “and”, “or”, and “not”. You can also use other operators to make equations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># everyone who chose either 0 or 7 for question moral1</span>
moral_extremes &lt;-<span class="st"> </span>disgust %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(moral1 ==<span class="st"> </span><span class="dv">0</span> |<span class="st"> </span>moral1 ==<span class="st"> </span><span class="dv">7</span>)

<span class="co"># everyone who chose the same answer for all moral questions</span>
moral_consistent &lt;-<span class="st"> </span>disgust %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(
    moral2 ==<span class="st"> </span>moral1 &amp;<span class="st"> </span>
<span class="st">      </span>moral3 ==<span class="st"> </span>moral1 &amp;<span class="st"> </span>
<span class="st">      </span>moral4 ==<span class="st"> </span>moral1 &amp;
<span class="st">      </span>moral5 ==<span class="st"> </span>moral1 &amp;
<span class="st">      </span>moral6 ==<span class="st"> </span>moral1 &amp;
<span class="st">      </span>moral7 ==<span class="st"> </span>moral1
  )

<span class="co"># everyone who did not answer 7 for all 7 moral questions</span>
moral_no_ceiling &lt;-<span class="st"> </span>disgust %&gt;%
<span class="st">  </span><span class="kw">filter</span>(moral1+moral2+moral3+moral4+moral5+moral6+moral7 !=<span class="st"> </span><span class="dv">7</span>*<span class="dv">7</span>)</code></pre></div>
<p>Sometimes you need to exclude some participant IDs for reasons that can’t be described in code. the <code>%in%</code> operator is useful here for testing if a column value is in a list. Surround the equation with parentheses and put <code>!</code> in front to test that a value is not in the list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">no_researchers &lt;-<span class="st"> </span>disgust %&gt;%
<span class="st">  </span><span class="kw">filter</span>(!(user_id %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)))</code></pre></div>
<p><a name="#dates"></a> You can use the <code>lubridate</code> package to work with dates. For example, you can use the <code>year()</code> function to return just the year from the <code>date</code> column and then select only data collected in 2010.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">disgust2010 &lt;-<span class="st"> </span>disgust  %&gt;%
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">year</span>(date) ==<span class="st"> </span><span class="dv">2010</span>)</code></pre></div>
<p>Or select data from at least 5 years ago. You can use the <code>range</code> function to check the minimum and maxiumum dates in the resulting dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">disgust_5ago &lt;-<span class="st"> </span>disgust %&gt;%
<span class="st">  </span><span class="kw">filter</span>(date &lt;<span class="st"> </span><span class="kw">today</span>() -<span class="st"> </span><span class="kw">dyears</span>(<span class="dv">5</span>))

<span class="kw">range</span>(disgust_5ago$date)</code></pre></div>
<pre><code>## [1] &quot;2008-07-10&quot; &quot;2012-09-13&quot;</code></pre>
</div>
<div id="arrange" class="section level3">
<h3>arrange()</h3>
<p><a name="#arrange"></a> Sort your dataset using <code>arrange()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">disgust_order &lt;-<span class="st"> </span>disgust %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(id)

<span class="kw">head</span>(disgust_order)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["user_id"],"name":[2],"type":["int"],"align":["right"]},{"label":["date"],"name":[3],"type":["date"],"align":["right"]},{"label":["moral1"],"name":[4],"type":["int"],"align":["right"]},{"label":["moral2"],"name":[5],"type":["int"],"align":["right"]},{"label":["moral3"],"name":[6],"type":["int"],"align":["right"]},{"label":["moral4"],"name":[7],"type":["int"],"align":["right"]},{"label":["moral5"],"name":[8],"type":["int"],"align":["right"]},{"label":["moral6"],"name":[9],"type":["int"],"align":["right"]},{"label":["moral7"],"name":[10],"type":["int"],"align":["right"]},{"label":["sexual1"],"name":[11],"type":["int"],"align":["right"]},{"label":["sexual2"],"name":[12],"type":["int"],"align":["right"]},{"label":["sexual3"],"name":[13],"type":["int"],"align":["right"]},{"label":["sexual4"],"name":[14],"type":["int"],"align":["right"]},{"label":["sexual5"],"name":[15],"type":["int"],"align":["right"]},{"label":["sexual6"],"name":[16],"type":["int"],"align":["right"]},{"label":["sexual7"],"name":[17],"type":["int"],"align":["right"]},{"label":["pathogen1"],"name":[18],"type":["int"],"align":["right"]},{"label":["pathogen2"],"name":[19],"type":["int"],"align":["right"]},{"label":["pathogen3"],"name":[20],"type":["int"],"align":["right"]},{"label":["pathogen4"],"name":[21],"type":["int"],"align":["right"]},{"label":["pathogen5"],"name":[22],"type":["int"],"align":["right"]},{"label":["pathogen6"],"name":[23],"type":["int"],"align":["right"]},{"label":["pathogen7"],"name":[24],"type":["int"],"align":["right"]}],"data":[{"1":"1","2":"1","3":"2008-07-10","4":"2","5":"2","6":"1","7":"2","8":"1","9":"1","10":"1","11":"3","12":"1","13":"1","14":"2","15":"1","16":"2","17":"2","18":"3","19":"2","20":"3","21":"3","22":"2","23":"3","24":"3"},{"1":"3","2":"155324","3":"2008-07-11","4":"2","5":"4","6":"3","7":"5","8":"2","9":"1","10":"4","11":"1","12":"0","13":"1","14":"2","15":"2","16":"6","17":"1","18":"4","19":"3","20":"1","21":"0","22":"4","23":"4","24":"2"},{"1":"4","2":"155366","3":"2008-07-12","4":"6","5":"6","6":"6","7":"3","8":"6","9":"6","10":"6","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"3","18":"4","19":"4","20":"5","21":"5","22":"4","23":"6","24":"0"},{"1":"5","2":"155370","3":"2008-07-12","4":"6","5":"6","6":"4","7":"6","8":"6","9":"6","10":"6","11":"2","12":"6","13":"4","14":"3","15":"6","16":"6","17":"6","18":"6","19":"6","20":"6","21":"2","22":"4","23":"4","24":"6"},{"1":"6","2":"155386","3":"2008-07-12","4":"2","5":"4","6":"0","7":"4","8":"0","9":"0","10":"0","11":"6","12":"0","13":"0","14":"6","15":"4","16":"4","17":"6","18":"4","19":"5","20":"5","21":"1","22":"6","23":"4","24":"2"},{"1":"7","2":"155409","3":"2008-07-12","4":"4","5":"5","6":"5","7":"4","8":"5","9":"1","10":"5","11":"3","12":"0","13":"1","14":"5","15":"2","16":"0","17":"0","18":"5","19":"5","20":"3","21":"4","22":"4","23":"2","24":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Reverse the order using <code>desc()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">disgust_order &lt;-<span class="st"> </span>disgust %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(id))

<span class="kw">head</span>(disgust_order)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["user_id"],"name":[2],"type":["int"],"align":["right"]},{"label":["date"],"name":[3],"type":["date"],"align":["right"]},{"label":["moral1"],"name":[4],"type":["int"],"align":["right"]},{"label":["moral2"],"name":[5],"type":["int"],"align":["right"]},{"label":["moral3"],"name":[6],"type":["int"],"align":["right"]},{"label":["moral4"],"name":[7],"type":["int"],"align":["right"]},{"label":["moral5"],"name":[8],"type":["int"],"align":["right"]},{"label":["moral6"],"name":[9],"type":["int"],"align":["right"]},{"label":["moral7"],"name":[10],"type":["int"],"align":["right"]},{"label":["sexual1"],"name":[11],"type":["int"],"align":["right"]},{"label":["sexual2"],"name":[12],"type":["int"],"align":["right"]},{"label":["sexual3"],"name":[13],"type":["int"],"align":["right"]},{"label":["sexual4"],"name":[14],"type":["int"],"align":["right"]},{"label":["sexual5"],"name":[15],"type":["int"],"align":["right"]},{"label":["sexual6"],"name":[16],"type":["int"],"align":["right"]},{"label":["sexual7"],"name":[17],"type":["int"],"align":["right"]},{"label":["pathogen1"],"name":[18],"type":["int"],"align":["right"]},{"label":["pathogen2"],"name":[19],"type":["int"],"align":["right"]},{"label":["pathogen3"],"name":[20],"type":["int"],"align":["right"]},{"label":["pathogen4"],"name":[21],"type":["int"],"align":["right"]},{"label":["pathogen5"],"name":[22],"type":["int"],"align":["right"]},{"label":["pathogen6"],"name":[23],"type":["int"],"align":["right"]},{"label":["pathogen7"],"name":[24],"type":["int"],"align":["right"]}],"data":[{"1":"38222","2":"51771","3":"2016-08-04","4":"2","5":"6","6":"4","7":"6","8":"6","9":"5","10":"4","11":"0","12":"0","13":"0","14":"6","15":"0","16":"6","17":"0","18":"5","19":"2","20":"5","21":"5","22":"5","23":"2","24":"3"},{"1":"38020","2":"452964","3":"2016-05-22","4":"2","5":"6","6":"4","7":"6","8":"6","9":"3","10":"6","11":"4","12":"1","13":"2","14":"3","15":"4","16":"5","17":"4","18":"5","19":"4","20":"3","21":"4","22":"4","23":"5","24":"6"},{"1":"37829","2":"4976","3":"2016-03-22","4":"6","5":"6","6":"6","7":"0","8":"6","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0","18":"6","19":"6","20":"6","21":"6","22":"0","23":"0","24":"6"},{"1":"37268","2":"72289","3":"2016-01-30","4":"3","5":"5","6":"4","7":"5","8":"6","9":"5","10":"3","11":"3","12":"1","13":"1","14":"6","15":"5","16":"6","17":"5","18":"4","19":"3","20":"3","21":"6","22":"4","23":"2","24":"3"},{"1":"37157","2":"141209","3":"2016-01-23","4":"2","5":"3","6":"5","7":"4","8":"2","9":"5","10":"2","11":"2","12":"0","13":"4","14":"6","15":"4","16":"5","17":"4","18":"4","19":"5","20":"3","21":"4","22":"5","23":"6","24":"5"},{"1":"37094","2":"138445","3":"2016-01-18","4":"1","5":"5","6":"1","7":"4","8":"0","9":"5","10":"5","11":"3","12":"0","13":"0","14":"4","15":"0","16":"4","17":"0","18":"6","19":"4","20":"1","21":"2","22":"3","23":"6","24":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="mutate" class="section level3">
<h3>mutate()</h3>
<p><a name="#mutate"></a> Add new columns. This is one of the most useful functions in the tidyverse.</p>
<p>Refer to other columns by their names (unquoted). You can add more than one column, just separate the columns with a comma. Once you make a new column, you can use it in further column definitions e.g., <code>total</code> below).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">disgust_total &lt;-<span class="st"> </span>disgust %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">pathogen =</span> pathogen1 +<span class="st"> </span>pathogen2 +<span class="st"> </span>pathogen3 +<span class="st"> </span>pathogen4 +<span class="st"> </span>pathogen5 +<span class="st"> </span>pathogen6 +<span class="st"> </span>pathogen7,
    <span class="dt">moral =</span> moral1 +<span class="st"> </span>moral2 +<span class="st"> </span>moral3 +<span class="st"> </span>moral4 +<span class="st"> </span>moral5 +<span class="st"> </span>moral6 +<span class="st"> </span>moral7,
    <span class="dt">sexual =</span> sexual1 +<span class="st"> </span>sexual2 +<span class="st"> </span>sexual3 +<span class="st"> </span>sexual4 +<span class="st"> </span>sexual5 +<span class="st"> </span>sexual6 +<span class="st"> </span>sexual7,
    <span class="dt">total =</span> pathogen +<span class="st"> </span>moral +<span class="st"> </span>sexual,
    <span class="dt">user_id =</span> <span class="kw">paste0</span>(<span class="st">&quot;U&quot;</span>, user_id)
  )</code></pre></div>
<p class="alert alert-warning">
You can overwrite a column by giving a new column the same name as the old column. Make sure that you mean to do this and that you aren’t trying to use the old column value after you redefine it.
</p>
</div>
<div id="summarise" class="section level3">
<h3>summarise()</h3>
<p><a name="#summarise"></a> Create summary statistics for the dataset. Check the <a href="https://www.rstudio.org/links/data_wrangling_cheat_sheet">Data Wrangling Cheat Sheet</a> or the <a href="https://github.com/rstudio/cheatsheets/raw/master/source/pdfs/data-transformation-cheatsheet.pdf">Data Transformation Cheat Sheet</a> for various summary functions. Some common ones are: <code>mean()</code>, <code>sd()</code>, <code>n()</code>, <code>sum()</code>, and <code>quantile()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">disgust_total %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">n =</span> <span class="kw">n</span>(),
    <span class="dt">q25 =</span> <span class="kw">quantile</span>(total, .<span class="dv">25</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">q50 =</span> <span class="kw">quantile</span>(total, .<span class="dv">50</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">q75 =</span> <span class="kw">quantile</span>(total, .<span class="dv">75</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">avg_total =</span> <span class="kw">mean</span>(total, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">sd_total  =</span> <span class="kw">sd</span>(total, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">min_total =</span> <span class="kw">min</span>(total, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">max_total =</span> <span class="kw">max</span>(total, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
  )</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["n"],"name":[1],"type":["int"],"align":["right"]},{"label":["q25"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["q50"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["q75"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["avg_total"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["sd_total"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["min_total"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["max_total"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"20000","2":"59","3":"71","4":"83","5":"70.6942","6":"18.22728","7":"0","8":"126","_row":"25%"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="group_by" class="section level3">
<h3>group_by()</h3>
<p><a name="#group_by"></a> Create subsets of the data. You can use this to create summaries, like the mean value for all of your experimental groups.</p>
<p>Here, we’ll use <code>mutate</code> to create a new column called <code>year</code>, group by <code>year</code>, and calculate the average scores.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">disgust_total %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">year</span>(date)) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(year) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">n =</span> <span class="kw">n</span>(),
    <span class="dt">avg_total =</span> <span class="kw">mean</span>(total, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">sd_total  =</span> <span class="kw">sd</span>(total, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">min_total =</span> <span class="kw">min</span>(total, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">max_total =</span> <span class="kw">max</span>(total, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
  )</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]},{"label":["avg_total"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["sd_total"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["min_total"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["max_total"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"2008","2":"2578","3":"70.29975","4":"18.46251","5":"0","6":"126"},{"1":"2009","2":"2580","3":"69.74481","4":"18.61959","5":"3","6":"126"},{"1":"2010","2":"1514","3":"70.59238","4":"18.86846","5":"6","6":"126"},{"1":"2011","2":"6046","3":"71.34425","4":"17.79446","5":"0","6":"126"},{"1":"2012","2":"5938","3":"70.42530","4":"18.35782","5":"0","6":"126"},{"1":"2013","2":"1259","3":"71.61025","4":"17.58410","5":"0","6":"126"},{"1":"2014","2":"58","3":"70.46296","4":"17.23502","5":"19","6":"113"},{"1":"2015","2":"21","3":"74.26316","4":"16.89787","5":"43","6":"107"},{"1":"2016","2":"6","3":"72.16667","4":"13.84798","5":"54","6":"87"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>You can use <code>filter</code> after <code>group_by</code>. The following example returns the lowest total score from each year.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">disgust_total %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">year</span>(date)) %&gt;%
<span class="st">  </span><span class="kw">select</span>(user_id, year, total) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(year) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">rank</span>(total) ==<span class="st"> </span><span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(year)</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["user_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["year"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["total"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"U236585","2":"2009","3":"3"},{"1":"U292359","2":"2010","3":"6"},{"1":"U245384","2":"2013","3":"0"},{"1":"U206293","2":"2014","3":"19"},{"1":"U407089","2":"2015","3":"43"},{"1":"U4976","2":"2016","3":"54"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>You can also use <code>mutate</code> after <code>group_by</code>. The following example calculates subject-mean-centered scores by grouping the scores by <code>user_id</code> and then subtracting the group-specific mean from each score. <span class="text-warning"> Note the use of <code>gather</code> to tidy the data into a long format first.</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">disgust_smc &lt;-<span class="st"> </span>disgust %&gt;%
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;question&quot;</span>, <span class="st">&quot;score&quot;</span>, moral1:pathogen7) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(user_id) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">score_smc =</span> score -<span class="st"> </span><span class="kw">mean</span>(score, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
</div>
<div id="all-together" class="section level3">
<h3>All Together</h3>
<p>A lot of what we did above would be easier if the data were tidy, so let’s do that first. Then we can use <code>group_by</code> to calculate the domain scores.</p>
<p class="alert alert-warning">
It is good practice to use <code>ungroup()</code> after using <code>group_by</code> and <code>summarise</code>. Forgetting to ungroup the dataset won’t affect some further processing, but can really mess up other things.
</p>
<p>Then we can spread out the 3 domains, calculate the total score, remove any rows with a missing (<code>NA</code>) total, and calculate mean values by year.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">disgust_tidy &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/disgust.csv&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;question&quot;</span>, <span class="st">&quot;score&quot;</span>, moral1:pathogen7) %&gt;%
<span class="st">  </span><span class="kw">separate</span>(question, <span class="kw">c</span>(<span class="st">&quot;domain&quot;</span>,<span class="st">&quot;q_num&quot;</span>), <span class="dt">sep =</span> -<span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(id, user_id, date, domain) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">score =</span> <span class="kw">mean</span>(score)) %&gt;%
<span class="st">  </span><span class="kw">ungroup</span>() %&gt;%
<span class="st">  </span><span class="kw">spread</span>(domain, score) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">total =</span> moral +<span class="st"> </span>sexual +<span class="st"> </span>pathogen,
    <span class="dt">year =</span> <span class="kw">year</span>(date)
  ) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(total)) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(user_id) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(year) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">n =</span> <span class="kw">n</span>(),
    <span class="dt">avg_pathogen =</span> <span class="kw">mean</span>(pathogen),
    <span class="dt">avg_moral =</span> <span class="kw">mean</span>(moral),
    <span class="dt">avg_sexual =</span> <span class="kw">mean</span>(sexual),
    <span class="dt">first_user =</span> <span class="kw">first</span>(user_id),
    <span class="dt">last_user =</span> <span class="kw">last</span>(user_id)
  )

disgust_tidy</code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]},{"label":["avg_pathogen"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["avg_moral"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["avg_sexual"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["first_user"],"name":[6],"type":["int"],"align":["right"]},{"label":["last_user"],"name":[7],"type":["int"],"align":["right"]}],"data":[{"1":"2008","2":"2392","3":"3.697265","4":"3.806259","5":"2.539298","6":"0","7":"188708"},{"1":"2009","2":"2410","3":"3.674333","4":"3.760937","5":"2.528275","6":"6093","7":"251959"},{"1":"2010","2":"1418","3":"3.731412","4":"3.843139","5":"2.510075","6":"5469","7":"319641"},{"1":"2011","2":"5586","3":"3.756918","4":"3.806506","5":"2.628612","6":"4458","7":"406569"},{"1":"2012","2":"5375","3":"3.740465","4":"3.774591","5":"2.545701","6":"2118","7":"458194"},{"1":"2013","2":"1229","3":"3.776241","4":"3.901778","5":"2.552017","6":"7646","7":"462456"},{"1":"2014","2":"54","3":"3.759259","4":"4.000000","5":"2.306878","6":"11090","7":"461307"},{"1":"2015","2":"19","3":"3.781955","4":"4.451128","5":"2.375940","6":"102699","7":"460283"},{"1":"2016","2":"6","3":"4.047619","4":"3.928571","5":"2.333333","6":"4976","7":"452964"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="exercises" class="section level2">
<h2>Exercises</h2>
<p>Use the data from <a href="data/personality.csv">personality.csv</a> for the following exercises.</p>
<p>These data are from a 5-factor (OCEAN) personality questionnaire. Each question is labelled with the domain (Op = openness, Co = concientiousness, Ex = extraversion, Ag = agreeableness, and Ne = neuroticism) and the question number.</p>
<ol style="list-style-type: decimal">
<li><p>Select all of the rows with <code>user_id</code>s from 1000 to 9999, inclusive (i.e., including both 1000 and 9999).</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">thousands &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/personality.csv&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(user_id &gt;=<span class="st"> </span><span class="dv">1000</span>, user_id &lt;<span class="st"> </span><span class="dv">10000</span>)</code></pre></div>
</div></li>
<li><p>Exclude all observations collected before 2007.</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post2007 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/personality.csv&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">year</span>(date) &gt;<span class="st"> </span><span class="dv">2007</span>)</code></pre></div>
</div></li>
<li><p>Select all of the columns with Extraversion questions.</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># this is the least efficient way</span>
extraversion1 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/personality.csv&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(Ex1, Ex2, Ex3, Ex4, Ex5, Ex6, Ex7, Ex8, Ex9)

<span class="co"># this is the most efficient way for this dataset</span>
extraversion2 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/personality.csv&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;Ex&quot;</span>))

<span class="co"># this works even if other columns starts with &quot;Ex&quot;</span>
extraversion3 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/personality.csv&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(<span class="kw">num_range</span>(<span class="st">&quot;Ex&quot;</span>, <span class="dv">1</span>:<span class="dv">9</span>))</code></pre></div>
</div></li>
<li><p>Tidy the dataset and calculate the mean score for each of the 5 personality factors. Count how many of the questions in each domain were answered by each user and filter to only people who answered at least 5 questions in each domain.</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ocean_tidy &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/personality.csv&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;question&quot;</span>, <span class="st">&quot;score&quot;</span>, Op1:Ex9) %&gt;%
<span class="st">  </span><span class="kw">separate</span>(question, <span class="kw">c</span>(<span class="st">&quot;domain&quot;</span>, <span class="st">&quot;q_num&quot;</span>), <span class="dt">sep=</span><span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(user_id, date, domain) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">valid =</span> <span class="kw">sum</span>(!<span class="kw">is.na</span>(score)),
    <span class="dt">mean_score =</span> <span class="kw">mean</span>(score, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
  ) %&gt;%
<span class="st">  </span><span class="kw">ungroup</span>() %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(date, user_id) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">min</span>(valid) &gt;=<span class="st"> </span><span class="dv">5</span>) %&gt;%
<span class="st">  </span><span class="kw">ungroup</span>()</code></pre></div></li>
<li><p>Create a violin plot of mean score distribution for each the 5 personality factors from the full dataset.</p>
<div class="solution">
<button>
Solution
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">read_csv</span>(<span class="st">&quot;data/personality.csv&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;question&quot;</span>, <span class="st">&quot;score&quot;</span>, Op1:Ex9) %&gt;%
<span class="st">  </span><span class="kw">separate</span>(question, <span class="kw">c</span>(<span class="st">&quot;domain&quot;</span>, <span class="st">&quot;q_num&quot;</span>), <span class="dt">sep=</span><span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(user_id, date, domain) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">mean_score =</span> <span class="kw">mean</span>(score, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
  ) %&gt;%
<span class="st">  </span><span class="kw">ungroup</span>() %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(domain, mean_score, <span class="dt">fill =</span> domain)) +
<span class="st">  </span><span class="kw">geom_violin</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">show.legend =</span> <span class="ot">FALSE</span>, <span class="dt">draw_quantiles =</span> <span class="kw">c</span>(<span class="fl">0.5</span>))</code></pre></div>
<p><img src="images/04/exercise-5-1.png" width="768" /></p>
</div></li>
</ol>
</div>

<!--
<p class="footer">
  This course free to use in any way under the
  <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0 License</a>
</p>
-->

<script>
  $(".solution").click(function() {
    $(this).toggleClass("open");
  });
</script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
